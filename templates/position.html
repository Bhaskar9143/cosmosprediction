<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicted Positions</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #positionChart {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Predicted Positions of Space Debris</h1>

        <!-- Scatter plot canvas -->
        <canvas id="positionChart"></canvas>

        <script>
            const ctx = document.getElementById('positionChart').getContext('2d');
            const positionData = {{ position_data | tojson }};
            
            const earthRadius = 6371; // Earth's radius in kilometers
            const positions = positionData.map(item => ({
                x: item.x,
                y: item.y,
                z: item.z
            }));

            // Create the 3D scatter plot
            const positionChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Predicted Positions',
                        data: positions,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        radius: 5
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { 
                            title: { display: true, text: 'X Position (km)' } 
                        },
                        y: { 
                            title: { display: true, text: 'Y Position (km)' } 
                        },
                        z: {
                            title: { display: true, text: 'Z Position (km)' },
                            type: 'linear',
                            position: 'right'
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return `Object: ${tooltipItem.raw.OBJECT_NAME}`;
                                }
                            }
                        }
                    }
                }
            });

            // Draw Earth as a sphere in the background
            function drawEarth() {
                const earthCanvas = document.createElement('canvas');
                const earthCtx = earthCanvas.getContext('2d');
                earthCanvas.width = 400;
                earthCanvas.height = 400;

                // Draw a circle representing Earth
                earthCtx.fillStyle = 'rgba(0, 0, 255, 0.3)';
                earthCtx.beginPath();
                earthCtx.arc(200, 200, earthRadius / 10, 0, Math.PI * 2);
                earthCtx.fill();

                // Add Earth canvas to the main canvas
                ctx.drawImage(earthCanvas, 0, 0);
            }

            drawEarth();
        </script>

        <!-- Table displaying predicted positions -->
        <h2 class="mt-5">Table of Predicted Positions</h2>
        <table class="table mt-3">
            <thead>
                <tr>
                    <th>Object Name</th>
                    <th>X Position</th>
                    <th>Y Position</th>
                    <th>Z Position</th>
                </tr>
            </thead>
            <tbody>
                {% for item in position_data %}
                <tr>
                    <td>{{ item.OBJECT_NAME }}</td>
                    <td>{{ item.x }}</td>
                    <td>{{ item.y }}</td>
                    <td>{{ item.z }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <a href="/">Back to Dashboard</a>
    </div>
</body>
</html>
